<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ó–∞–¥–∞—á–∏ –æ—Ç–¥–µ–ª–æ–≤</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--tg-theme-bg-color, #f4f4f5);
            color: var(--tg-theme-text-color, #000);
            min-height: 100vh;
        }

        /* --- –®–∞–ø–∫–∞ --- */
        .header {
            display: flex; align-items: center; gap: 12px;
            padding: 16px 20px;
            background: var(--tg-theme-bg-color, #fff);
            border-bottom: 1px solid var(--tg-theme-hint-color, #e0e0e0);
            position: sticky; top: 0; z-index: 10;
        }
        .header h2 { font-size: 18px; font-weight: 700; flex: 1; }
        .btn-back {
            background: none; border: none; cursor: pointer;
            font-size: 20px; color: var(--tg-theme-button-color, #3390ec);
            padding: 4px 8px 4px 0;
        }
        .btn-all-tasks {
            padding: 8px 14px; border: none; border-radius: 10px; cursor: pointer;
            background: var(--tg-theme-button-color, #3390ec);
            color: var(--tg-theme-button-text-color, #fff);
            font-size: 14px; font-weight: 600; white-space: nowrap;
        }

        /* --- –ï–∫—Ä–∞–Ω –≤—ñ–¥–¥—ñ–ª—ñ–≤ --- */
        .screen { padding: 16px 20px; }
        .department-btn {
            display: block; width: 100%; padding: 18px; margin-bottom: 12px;
            background: var(--tg-theme-button-color, #3390ec);
            color: var(--tg-theme-button-text-color, #fff);
            border: none; border-radius: 14px;
            font-size: 17px; font-weight: 700; cursor: pointer;
            text-align: center; transition: opacity 0.15s;
        }
        .department-btn:active { opacity: 0.75; }

        /* --- –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á --- */
        .tasks-toolbar {
            display: flex; gap: 8px; margin-bottom: 16px;
        }
        .btn-refresh {
            padding: 10px 16px; border: none; border-radius: 10px; cursor: pointer;
            background: var(--tg-theme-secondary-bg-color, #e8e8e8);
            color: var(--tg-theme-text-color, #000);
            font-size: 14px;
        }
        .btn-new-task {
            flex: 1; padding: 10px 16px; border: none; border-radius: 10px; cursor: pointer;
            background: var(--tg-theme-button-color, #3390ec);
            color: var(--tg-theme-button-text-color, #fff);
            font-size: 14px; font-weight: 600;
        }

        .loading { text-align: center; padding: 40px 20px; color: var(--tg-theme-hint-color, #888); }

        .task-card {
            background: var(--tg-theme-bg-color, #fff);
            border-radius: 14px; padding: 14px 16px; margin-bottom: 12px;
            box-shadow: 0 1px 6px rgba(0,0,0,0.07);
        }
        .task-card.task-done { opacity: 0.6; }
        .task-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 6px;
        }
        .task-dept {
            font-size: 12px; font-weight: 700;
            color: var(--tg-theme-button-color, #3390ec);
            background: rgba(51,144,236,0.1);
            padding: 2px 8px; border-radius: 6px;
        }
        .task-status { font-size: 12px; color: var(--tg-theme-hint-color, #888); }
        .task-title { font-size: 16px; font-weight: 600; margin-bottom: 8px; }
        .task-meta {
            display: flex; flex-wrap: wrap; gap: 8px;
            font-size: 12px; color: var(--tg-theme-hint-color, #888);
            margin-bottom: 10px;
        }
        .task-actions { display: flex; gap: 8px; }
        .btn-complete {
            flex: 1; padding: 10px; border: none; border-radius: 10px; cursor: pointer;
            background: #34c759; color: #fff;
            font-size: 13px; font-weight: 600;
        }
        .btn-delete {
            padding: 10px 14px; border: none; border-radius: 10px; cursor: pointer;
            background: var(--tg-theme-secondary-bg-color, #e8e8e8);
            color: #ff3b30; font-size: 13px; font-weight: 600;
        }

        /* --- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ --- */
        .modal-overlay {
            display: none; position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 100; align-items: center;
            justify-content: center; padding: 20px;
        }
        .modal-overlay.active { display: flex; }
        .modal {
            background: var(--tg-theme-bg-color, #fff);
            border-radius: 16px; padding: 24px; width: 100%;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            animation: popIn 0.2s ease;
        }
        @keyframes popIn {
            from { transform: scale(0.92); opacity: 0; }
            to   { transform: scale(1);    opacity: 1; }
        }
        .modal h3 { font-size: 18px; font-weight: 700; margin-bottom: 16px; }
        .modal input {
            width: 100%; padding: 14px 16px; margin-bottom: 16px;
            border: 1.5px solid var(--tg-theme-hint-color, #c8c8c8);
            border-radius: 12px; font-size: 16px;
            background: var(--tg-theme-secondary-bg-color, #f4f4f5);
            color: var(--tg-theme-text-color, #000);
            outline: none; transition: border-color 0.2s;
        }
        .modal input:focus { border-color: var(--tg-theme-button-color, #3390ec); }
        .modal input.error { border-color: #ff3b30; }
        .modal-buttons { display: flex; gap: 10px; }
        .btn-cancel {
            flex: 1; padding: 14px; border: none; border-radius: 12px; cursor: pointer;
            background: var(--tg-theme-secondary-bg-color, #e8e8e8);
            color: var(--tg-theme-text-color, #000); font-size: 15px;
        }
        .btn-create {
            flex: 1; padding: 14px; border: none; border-radius: 12px; cursor: pointer;
            background: var(--tg-theme-button-color, #3390ec);
            color: var(--tg-theme-button-text-color, #fff);
            font-size: 15px; font-weight: 700;
        }

        /* --- –ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è --- */
        .confirm-text { font-size: 15px; margin-bottom: 20px; line-height: 1.4; }
        .btn-confirm-ok {
            flex: 1; padding: 14px; border: none; border-radius: 12px; cursor: pointer;
            background: #ff3b30; color: #fff; font-size: 15px; font-weight: 700;
        }
    </style>
</head>
<body>

<!-- –®–∞–ø–∫–∞ -->
<div class="header">
    <button class="btn-back" id="btn-back" onclick="showDepartments()" style="display:none">‚Üê</button>
    <h2 id="header-title">–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ç–¥–µ–ª</h2>
    <button class="btn-all-tasks" onclick="showTasks(null)">–í—Å–µ –∑–∞–¥–∞—á–∏</button>
</div>

<!-- –ï–∫—Ä–∞–Ω –≤—ñ–¥–¥—ñ–ª—ñ–≤ -->
<div class="screen" id="screen-departments">
    <button class="department-btn" onclick="openModal('Casino')">üé∞ Casino</button>
    <button class="department-btn" onclick="openModal('Operations')">‚öôÔ∏è Operations</button>
    <button class="department-btn" onclick="openModal('Traffic')">üìà Traffic</button>
    <button class="department-btn" onclick="openModal('Product')">üì¶ Product</button>
    <button class="department-btn" onclick="openModal('Retention')">üß≤ Retention</button>
</div>

<!-- –ï–∫—Ä–∞–Ω –∑–∞–¥–∞—á -->
<div class="screen" id="screen-tasks" style="display:none">
    <div class="tasks-toolbar">
        <button class="btn-refresh" onclick="loadTasks(currentDepartment)">üîÑ</button>
        <button class="btn-new-task" id="btn-new-task" onclick="openModal(currentDepartment)">+ –ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞</button>
    </div>
    <div id="tasks-list"></div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è -->
<div id="modal-overlay" class="modal-overlay">
    <div class="modal">
        <h3 id="modal-title">–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞</h3>
        <input type="text" id="modal-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏..."
               onkeydown="if(event.key==='Enter') submitTask()"/>
        <div class="modal-buttons">
            <button class="btn-cancel" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
            <button class="btn-create" onclick="submitTask()">–°–æ–∑–¥–∞—Ç—å ‚úì</button>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è -->
<div id="confirm-overlay" class="modal-overlay">
    <div class="modal">
        <p class="confirm-text" id="confirm-text"></p>
        <div class="modal-buttons">
            <button class="btn-cancel" onclick="closeConfirm()">–û—Ç–º–µ–Ω–∞</button>
            <button class="btn-confirm-ok" id="confirm-ok">–£–¥–∞–ª–∏—Ç—å</button>
        </div>
    </div>
</div>

<script src="script.js" defer></script>
<script>
    // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —à–∞–ø–∫–∏ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–Ω—ñ –µ–∫—Ä–∞–Ω—ñ–≤
    const origShowDepts = showDepartments;
    const origShowTasks = showTasks;

    window.showDepartments = function() {
        document.getElementById('header-title').textContent = '–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ç–¥–µ–ª';
        document.getElementById('btn-back').style.display = 'none';
        document.getElementById('btn-new-task').style.display = 'none';
        origShowDepts && origShowDepts();
    };

    window.showTasks = function(dept) {
        document.getElementById('header-title').textContent = dept ? `–ó–∞–¥–∞—á–∏: ${dept}` : '–í—Å–µ –∑–∞–¥–∞—á–∏';
        document.getElementById('btn-back').style.display = 'block';
        document.getElementById('btn-new-task').style.display = dept ? 'block' : 'none';
        origShowTasks && origShowTasks(dept);
    };
</script>
</body>
</html>
